<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>Easy, Scalable, and Efficient Apex Data Transforms with DataWeave – Let’s get Started</title>

		<link rel="stylesheet" href="dist/reset.css">
		<link rel="stylesheet" href="dist/reveal.css">
		<link rel="stylesheet" href="dist/theme/czechdreamin23.css">

		<!-- Theme used for syntax highlighted code -->
		<link rel="stylesheet" href="plugin/highlight/monokai.css">
		<link href="../node_modules/@fortawesome/fontawesome-free/css/fontawesome.css" rel="stylesheet">
		<link href="../node_modules/@fortawesome/fontawesome-free/css/brands.css" rel="stylesheet">
		<link href="../node_modules/@fortawesome/fontawesome-free/css/solid.css" rel="stylesheet">
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<!-- 
					===========================================================
					HEADER
				-->
				<header id='header' class="hidden">
					<p class="czechtags"><a href="https://twitter.com/CzechDreamin">#CD2023 @CzechDreamin</a></p>
					<img src="assets/imgs/czechdreamin-logo.png">
				</header>


				<!-- 
					===========================================================
					TITLE
				-->
				<section id="title" class="title-slide" data-background-image ="assets/imgs/opening-slide.svg" 
				data-background-size="contain">
				<aside class="notes">
					<ul>
						<li>Thank sponsors and organisers</li>
					</ul>
				</aside>	
				</section>


				<!-- 
					===========================================================
					ME
				-->
				<section id="me" class="has-header">
					<h1>Me</h1>
					<ul>
						<li>Mobile Technical Architect @ <a href="https://caddify.com/">Caddify</a></li>
						<li>London Dev Group organiser</li>
						<li><a href="https://londonscalling.net">London's Calling</a> organiser</li>
						<li>Salesforce MVP</li>
						<li>Founder of <a href="https://shirtforce.org">Shirtforce</a></li>
					</ul>
					<img class="r-stretch"  data-src="assets/imgs/todd.jpeg">
					<p>&nbsp;</p>
				</section>


				<!-- 
					===========================================================
					TOPIC INTRO
				 -->
				 <section class="has-header">
					<h1>Apex data transforms with DataWeave</h1>
					<ul>
						<li class="fade-in-then-semi-out fragment">What, Why, and when</li>
						<li class="fade-in-then-semi-out fragment">Tooling</li>
						<li class="fade-in-then-semi-out fragment">Examples</li>
						<li class="fade-in-then-semi-out fragment">Benefits &amp; Limitations</li>
						<li class="fade-in-then-semi-out fragment">The future</li>
					</ul>
					<aside class="notes">
						<ul>
							<li>Aimed at getting started</li>
						</ul>
					</aside>	
				</section>


				<!-- 
					===========================================================
					WHAT
					TODO: 
				 -->
				 <section class="has-header">
					<h1>DataWhat</h1>
					<ul>
						<li class="fade-in-then-semi-out fragment">Data Transformation Framework</li>
						<li class="fade-in-then-semi-out fragment">Functional</li>
						<li class="fade-in-then-semi-out fragment">Packageable</li>
						<li class="fade-in-then-semi-out fragment">In Beta - GA in Summer<br/><span class="accent">(safe harbour)</span></li>
					</ul>
					<aside class="notes">
						<ul>
							<li>From Mulesoft</li>
							<li></li>
						</ul>
					</aside>	
				</section>


				<!-- 
					===========================================================
					WHY & WHEN
					TODO: 
				 -->
				 <section class="has-header">
					<h1>DataWhy &amp; DataWhen</h1>
					<ul>
						<li class="fade-in-then-semi-out fragment">Reduced amount of code</li>
						<li class="fade-in-then-semi-out fragment">Eases complex transformation tasks<br/><span class="accent">e.g. sObject &rArr;XML</span></li>
						<li class="fade-in-then-semi-out fragment">Highly scaleable</li>
						<li class="fade-in-then-semi-out fragment">Useful for Mulesoft</li>
					</ul>
					<aside class="notes">
						<ul>
							<li>Less errors - built in functions</li>
							<li></li>
						</ul>
					</aside>	
				</section>


				<!-- 
					===========================================================
					Our first example
					TODO: 
					- example
					- structure screenshots/code
				 -->
				 <section class="has-header">
					<h1>Let's dive in</h1>
					<pre class="center"><code data-trim data-line-numbers="0|1|2|3|4-7|0">
						%dw 2.0
						output application/csv
						---
						[
							{"Name": "CzechDreamin", "City": "Prague"},
							{"Name": "London's Calling", "City": "London"}
						]
					</code></pre>
					<div class="fragment">
						<i class="fa fa-down-long fa-2x center"></i>
						<pre class="center language-css"><code data-trim data-line-numbers>
							Name,City
							CzechDreamin,Prague
							London's Calling,London						
						</code></pre>
					</div>
					<aside class="notes">
						<ul>
							<li></li>
							<li></li>
						</ul>
					</aside>	
				</section>


				<!-- 
					===========================================================
					Let's go a bit further
				 -->
				 <section class="has-header">
					<h1>Let's go a bit further</h1>
					<pre><code data-trim data-line-numbers>
						%dw 2.0
						var data = [
							{"Name": "CzechDreamin", "City": "Prague"},
							{"Name": "London's Calling", "City": "London"}
						]
						output application/json
						---
						{
							"Names": data.Name,
							"Cities": data.City
						}
					</code></pre>
					<aside class="notes">
						<ul>
							<li></li>
							<li></li>
						</ul>
					</aside>	

				</section>
				<section class="has-header">
					<h1>Let's go a bit further</h1>
					<div class="cols-2 gap-1">
						<div class="col">
						<h3>DataWeave Script</h3>
						<pre><code data-trim data-line-numbers>
							%dw 2.0
							var data = [
								{"Name": "CzechDreamin", ...},
								{"Name": "London's Calling", ...}
							]
							output application/json
							---
							{
								"Names": data.Name,
								"Cities": data.City
							}
						</code></pre>
						</div>
						<div class="col">
							<h3>Output</h3>
							<pre class="language-json"><code data-trim>
								{
									"Names": [
										"CzechDreamin",
										"London's Calling"
									],
									"Cities": [
										"Prague",
										"London"
									]
								}					
							</code></pre>
						</div>
					</div>
					<aside class="notes">
						<ul>
							<li></li>
							<li></li>
						</ul>
					</aside>	
				</section>


				<!-- 
					===========================================================
					PLAYGROUND - VIDEO
					- Payload
				 -->
				<section id="playground" class="fullvideo" data-background-video ="assets/vids/playground-01.webm" 
				data-background-size="contain">
					<aside class="notes">
						<ul>
							<li>UI Left input, center script, right output</li>
							<li>Swap input</li>
							<li>Swap output</li>
							<li>Root element for XML</li>
							<li>Child elements - still taking the 1st line as element names</li>
							<li>Map custom element names</li>
							<li>Built in functions</li>
						</ul>
					</aside>
				</section>

				<!-- 
					===========================================================
					VS CODE
					- VIDEO
					- extension - file creation and preview
				 -->
				 <section id="vscode-01" class="fullvideo" data-background-video ="assets/vids/vscode-01.webm" 
				 data-background-size="contain">
					 <aside class="notes">
						 <ul>
							 <li>VS Code extension</li>
							 <li>Command palette - create mapping</li>
							 <li>Preview of output</li>
							 <li>Define input variable - put var into transform</li>
							 <li>Sample data -  set CSV content</li>
							 <li>Output updates</li>
							 <li>Apex errors</li>
						 </ul>
					 </aside>
				 </section>
				

				<!-- 
					===========================================================
					YOU SAID THERE'D BE APEX
				-->
				<section id="you-said-apex" class="has-header">
					<h1>You said somthing about be Apex</h1>
					<!-- TODO - IMAGE - Stropping kid -->

					<pre class="center fragment"><code class="javascript" data-trim data-line-numbers="0|2-3|5-9|0">
						%dw 2.0
						input records application/csv
						output application/apex
						---
						records map(record) -> {
							FirstName: record.fname,
							LastName: record.lname,
							Email: record.email
						} as Object {class: "Contact"}
					</code></pre>
					<aside class="notes">
					<ul>
						<li>output</li>
						<li>records as input</li>
						<li>as Object</li>
					</ul>
					</aside>
				</section>
				

				<!-- 
					===========================================================
					Apex Finally
				-->
				<section id="apex-finally" class="has-header">
					<h1>Apex... finally</h1>
					<!-- TODO - IMAGE - Stropping kid -->

					<pre><code class="java" data-trim data-line-numbers="0|2-3|5|6-8|10-11|0">
						// CSV data for Contacts
						String scriptName = 'csvToContacts';
						String inCsv = 'fname,lname,email\nCodey,"The Bear",codey@salesforce.com';

						DataWeave.Script dwscript = DataWeave.Script.createScript(scriptName);
						DataWeave.Result dwresult = dwscript.execute(
							new Map&#60String, Object>{'records' => inCsv}
						);

						List&#60Contact> results = (List&#60Contact>)dwresult.getValue();
						System.debug(results[0]);
					</code></pre>
					<aside class="notes">
					<ul>
						<li></li>
					</ul>
					</aside>
				</section>
				<section id="csvToContacts-01" class="fullvideo" data-background-video ="assets/vids/csvToContacts-01.webm" 
				 data-background-size="contain">
					 <aside class="notes">
						 <ul>
							 <li>string csv format</li>
							 <li>Show debug line</li>
							 <li>Took 13 seconds!!!</li>
						 </ul>
					 </aside>
				 </section>


				<!-- 
					===========================================================
					Let's go further
					TODO: 
					- CSV
					- Web Service
					- data types/functional + array funcs/See notes
					- XML Example
				 -->
				 <section id="take-things-further-01" class="has-header">
					<h1>Let's take things further</h1>
					<div class="cols-1-3">
						<div class="col">
							<h2>What we have</h2>
							<ul>
								<li>Account</li>
								<li>Invoices</li>
							</ul>
							<p>&nbsp;</p>
							<h2>What we want</h2>
							<ul>
								<li>XML Output</li>
								<li>Date formatting</li>
								<li>Defaults</li>
							</ul>
						</div>
						<div class="col">
							<pre><code class="xml" data-trim data-line-numbers="0|3,6|8|9|0">
								&#60?xml version='1.0' encoding='UTF-8'?>
								&#60REPORT>
									&#60VENDOR_NAME ID="Id">Name&#60/VENDOR_NAME>
									&#60INVOICES>
										&#60INVOICE>
										&#60INVOICE_NUM ID="Id">Name&#60/INVOICE_NUM>
										&#60ENT_AMT>Amount&#60/ENT_AMT>
										&#60INVOICE_DATE>dd-MMM-yy&#60/INVOICE_DATE>
										&#60PAYMENT_TERMS>default = 30&#60/PAYMENT_TERMS>
										&#60/INVOICE>

										&#60INVOICE>
										...
										&#60/INVOICE>
									&#60/INVOICES>
								&#60/REPORT>
							</code></pre>
						</div>
					</div>
					<aside class="notes">
						<ul>
							<li>Data model</li>
							<li>XML - namespacing, attributes</li>
							<li>Functional -> funcs as vars</li>
							<li>Formatting</li>
							<li>Default</li>
						</ul>
					</aside>	
				</section>

				<!-- 
					===========================================================
					OUR INVOICE RECORDS
					TODO: 
				 -->
				 <section class="has-header">
					<h1>Our Records</h1>
					<img class="screenshot center" src="assets/imgs/dw-invoices-02.png"/>
					<aside class="notes">
						<ul>
							<li>2 entries</li>
							<li>Date</li>
							<li>1 null payment term</li>
						</ul>
					</aside>	
				</section>
				
				<!-- 
					===========================================================
					WEB SERVICE
				-->
				<section id="invoice-web-service" class="has-header">
					<h1>A simple web service</h1>

					<pre><code class="java" data-trim data-line-numbers="0|1-2|5-6|8-9|10-12|15|0">
						@HttpGet
						global static void doGet() {
							...
							
							List&#60DW_Invoice__c> invoices = [SELECT ...];
							Account acc = invoices[0].Account__r;

							String scriptName = 'invoiceToXml';
							DataWeave.Script dwscript = DataWeave.Script.createScript(scriptName);
							DataWeave.Result dwresult = dwscript.execute(new Map&#60String, Object>{
								'invoices' => invoices, 'account' => acc
							});

							RestResponse res = RestContext.response;
							res.responseBody = Blob.valueOf(dwresult.getValueAsString());
						}
					</code></pre>
					<aside class="notes">
					<ul>
						<li>Basic web service</li>
						<li>2 Inputs to the script</li>
						<li>HOW SIMPLE!</li>
					</ul>
					</aside>
				</section>

				
				<!-- 
					===========================================================
					INVOICE TARGET XML
				-->
				<section id="invoice-target-xml" class="has-header">
					<pre><code class="java" data-trim data-line-numbers="0|3|4,15|6|8|9">
						&#60?xml version='1.0' encoding='UTF-8'?>
						&#60REPORT>
							&#60VENDOR_NAME ID="Id">Name&#60/VENDOR_NAME>
							&#60INVOICES>
								&#60INVOICE>
								&#60INVOICE_NUM ID="Id">Name&#60/INVOICE_NUM>
								&#60ENT_AMT>Amount&#60/ENT_AMT>
								&#60INVOICE_DATE>dd-MMM-yy&#60/INVOICE_DATE>
								&#60PAYMENT_TERMS>default = 30&#60/PAYMENT_TERMS>
								&#60/INVOICE>

								&#60INVOICE>
								...
								&#60/INVOICE>
							&#60/INVOICES>
						&#60/REPORT>
					</code></pre>
					<aside class="notes">
					<ul>
						<li>Target XML</li>
						<li>Elements have attributes</li>
						<li>Number of INVOICES</li>
						<li>Format the date</li>
						<li>Default value</li>
					</ul>
					</aside>
				</section>
				
				
				<!-- 
					===========================================================
					INVOICE DW SCRIPT
				-->
				<section id="invoice-dw-script" class="has-header">
					<pre><code class="java" data-trim data-line-numbers="0|1-2|3|6|7-9,15|12-13|14|0">
						input invoices application/apex
						input account application/apex
						var defaultPaymentTerms = 30
						---
						REPORT: {
							VENDOR_NAME @(ID: account.Id): account.Name,
							INVOICES:
								INVOICE:
									invoices map(record) -> {
										INVOICE_NUM @(ID: record.Id): record.Name,
										ENT_AMT: record.Entered_Amount__c,
										INVOICE_DATE : (record.Invoice_Date__c >> "UTC") 
										  as String {format: "dd-MMM-yy"},
										PAYMENT_TERMS: record.Payment_Terms__c default defaultPaymentTerms
									}
						}
					</code></pre>
					<aside class="notes">
					<ul>
						<li>2 Inputs to the script</li>
						<li>Var - not best example for default</li>
						<li>Puts ID attribute inside VENDOR_NAME</li>
						<li>Map</li>
						<li>Date format</li>
						<li>Default</li>
					</ul>
					</aside>
				</section>


				<!-- 
					===========================================================
					WEB SERVICE IN ACTION
				 -->
				<section id="csvToContacts-01" class="fullvideo" data-background-video ="assets/vids/postman-01.webm" 
				 data-background-size="contain">
					 <aside class="notes">
						 <ul>
							 <li>Postman</li>
							 <li>Needed several tries - timeouts</li>
						 </ul>
					 </aside>
				 </section>

				<!-- 
					===========================================================
					LIMITATIONS & Benefits
				 -->
				 <section class="has-header">
					<h1>There it is<span class="fragment">, but what else do I need to know</span></h1>
					<div class="cols-2">
						<div class="col fragment">
							<h2>Limitations</h2>
							<ul>
								<li class="">Performance</li>
								<li class="">No Excel Type</li>
							</ul>
						</div>
						<div class="col fragment">
							<h2>But... the Benefits</h2>
							<ul>
								<li class="">A LOT less Apex</li>
								<li class="">Increased power</li>
								<li class="">Reduced complexity</li>
								<li class="">Highly scaleable</li>
							</ul>
						</div>
					</div>
					<aside class="notes">
						<ul>
							<li>10 lines of apex, 10 of script</li>
							<li>So less erroneous</li>
						</ul>
					</aside>	
				</section>								

				
				<!-- 
					===========================================================
					The Future
					- Roadmap
					- Next Steps
				 -->
				 <section class="has-header">
					<h1>The Future</h1>
					<div class="cols-2">
						<div class="col fragment">
							<h2>Roadmap</h2>
							<ul>
								<li class="">GA (fingers crossed)</li>
								<li class="">Performance</li>
							</ul>
						</div>
						<div class="col fragment">
							<h2>Next Steps</h2>
							<ul>
								<li class="">Tutorials &amp; Challenges</li>
								<li class="">Try in the playground, or VS Code</li>
							</ul>
						</div>
					</div>
					<aside class="notes">
						<ul>
							<li>tbc</li>
						</ul>
					</aside>	
				</section>


				<!-- 
					===========================================================
					RESOURCES
					TODO: Bitlys
				 -->
				 <section class="has-header">
					<h1>Resources</h1>
					<ul>
						<li class="">Apex Documentation<br/><a  target="_blank" href="#">TBC</a></li>
						<li class="">DeveloperForce github<br/><a  target="_blank" href="#">TBC</a></li>
						<li class="">Daniel Stange Apex Hours Video<br/><a  target="_blank" href="#">TBC</a></li>
					</ul>
					<aside class="notes">
						<ul>
							<li>tbc</li>
						</ul>
					</aside>	
				</section>


				<!-- 
					===========================================================
					Q&A
				-->
				<section id="qAndA" class="has-header title-slide">
					<h1>Any questions?</h1>
				</section>
				<!-- 
					===========================================================
					THANK YOU
				-->
				<section id="thankyou" class="title-slide" data-background-image ="assets/imgs/thank-you-slide.svg" 
				data-background-size="contain">
				</section>

				<!-- 
					===========================================================
					FOOTER
				-->
				<footer id='footer' class="hidden">
					<p class="author"><a href="https://twitter.com/toddhalfpenny">@toddhalfpenny</a></p>
				</footer>
			</div>
		</div>

		<script src="dist/reveal.js"></script>
		<script src="plugin/notes/notes.js"></script>
		<script src="plugin/markdown/markdown.js"></script>
		<script src="plugin/highlight/highlight.js"></script>
		<script src="plugin/zoom/zoom.js"></script>
		<script>
			// COMMENTED OUT STUFF FROM C'DREAMIN 22 TALK
			Reveal.initialize({
				controls: false,
				hash: true,
				center: false,
				maxScale: 1.8,
				margin: 0.10,
				progress: false,
				width: 1500,
				height: 900,

				plugins: [ RevealMarkdown, RevealHighlight, RevealNotes, RevealZoom ]
			});
			Reveal.on( 'slidechanged', event => {
				console.log('slidechanged', event.currentSlide);
				if (event.currentSlide.className.includes('has-header')) {
					showFooter();
					showHeader();
				} else {
					hideFooter();
					hideHeader();
				}
				//console.log( 'classname', event.currentSlide.className);
				//setTimeout(() => {
				//	if (event.currentSlide.className.includes('fullvideo')) {
				//		const vidBackground = document.getElementsByClassName('slide-background present')[0];
				//		console.log(vidBackground);
				//		if (vidBackground) {
				//			vidBackground.getElementsByTagName('video')[0].play();
				//		}
				//	}
				//}, 500);
			} );

			function hideFooter() {
				console.log('hideFooter');
				let el = document.getElementById('footer');
				console.log('footer', el);
				if (el.className !== 'hidden'){ el.className = 'hidden' };
			}

			function showFooter() {
				console.log('showFooter');
				let el = document.getElementById('footer');
				console.log('footer', el);
				if (el.className && el.className === 'hidden'){ el.className = ''};
			}

			function hideHeader() {
				console.log('hideHeader');
				let el = document.getElementById('header');
				console.log('header', el);
				if (el.className !== 'hidden'){ el.className = 'hidden' };
			}

			function showHeader() {
				console.log('showHeader');
				let el = document.getElementById('header');
				console.log('header', el);
				if (el.className && el.className === 'hidden'){ el.className = ''};
			}
		</script>
	</body>
</html>
